"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const net_service_1 = require("../../../../service/net.service");
let interval = null;
Page({
    scoreList: {},
    data: {
        patrolData: {},
        scoring: {},
        scoring_index: 0,
    },
    bindKeyInput(e) {
        clearInterval(interval);
        interval = setTimeout(() => {
            let temp = this.data.scoring;
            let deduct_points = e.detail.value / 1;
            temp.detail[e.currentTarget.dataset.index].detail[e.currentTarget.dataset.i].deduct_points = deduct_points;
            this.setData({
                scoring: temp
            });
        }, 1000);
    },
    calcula(sub) {
        let total = sub.deduct_points / 1;
        sub.detail.forEach((element) => {
            total = element.deduct_points / 1 + total;
        });
        return total;
    },
    init() {
        net_service_1.default.getCurrentPenalties("unit").then((res) => {
            this.setData({
                patrolData: res
            });
            this.setData({
                scoring_index: wx.getStorageSync('scoring_index'),
            });
            let scoring = this.data.patrolData.penalties[this.data.scoring_index];
            scoring.detail.forEach((element) => {
                element.deduct_points = 0;
            });
            scoring.deduct_points = 0;
            this.setData({
                scoring: scoring
            });
            console.log(this.data);
        });
    },
    onRemoveImgTap(e) {
        console.log(e, 'delete');
        let images = e.detail.all;
        let index = e.currentTarget.dataset.index;
        let scoring = this.data.scoring;
        scoring.detail[index].image_url = images;
        this.setData({
            scoring: scoring
        });
        console.log(this.data.scoring);
    },
    onImgChangeTap(e) {
        let images = e.detail.current;
        let index = e.currentTarget.dataset.index;
        let scoring = this.data.scoring;
        console.log(images);
        net_service_1.default.uploadImgs(images).then((res) => {
            scoring.detail[index].image_url = [...scoring.detail[index].image_url, ...res];
            this.setData({
                scoring: scoring
            });
        }, (err) => {
            this.setData({
                scoring: scoring
            });
        });
    },
    textInput(e) {
        let text = e.detail.value;
        let index = e.currentTarget.dataset.index;
        let scoring = this.data.scoring;
        scoring.detail[index].desc = text;
        this.setData({
            scoring: scoring
        });
    },
    check() {
        let flag = true;
        let scoring = this.data.scoring;
        scoring.detail.forEach((element) => {
            if (element.deduct_points > 0 && element.image_url.length < 1) {
                flag = false;
            }
        });
        if (!flag) {
            wx.showToast({
                title: '请为扣分项上传图片',
                icon: 'none',
                duration: 2000
            });
        }
        return flag;
    },
    calPoit() {
        let scoring = this.data.scoring;
        scoring.detail.forEach((element) => {
            element.deduct_points = 0;
            element.deduct_points = this.calcula(element);
        });
        scoring.deduct_points = 0;
        scoring.deduct_points = this.calcula(scoring);
        this.setData({
            scoring: scoring
        });
    },
    save(e) {
        wx.showLoading({
            title: '提交中'
        });
        this.calPoit();
        let canSave = this.check();
        if (!canSave) {
            return;
        }
        let patrolData = this.data.patrolData;
        patrolData['penalties'][this.data.scoring_index] = this.data.scoring;
        net_service_1.default.saveCurrentPenalties(patrolData).then((res) => {
            wx.removeStorageSync('scoring_index');
            wx.hideLoading();
            wx.navigateBack();
        });
    },
    onLoad() {
        wx.showLoading({ title: '加载中' });
        this.init();
    },
    onReady() {
    },
    onShow() {
        wx.hideLoading();
    },
    onHide() {
    },
    onUnload() {
    },
    onPullDownRefresh() {
    },
    onReachBottom() {
    },
    onShareAppMessage(opts) {
        console.log(opts.target);
        return {};
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb3JpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzY3JvcmluZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlFQUFrRDtBQUNsRCxJQUFJLFFBQVEsR0FBTyxJQUFJLENBQUM7QUFDeEIsSUFBSSxDQUFDO0lBS0gsU0FBUyxFQUFNLEVBQUU7SUFDakIsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFNLEVBQUU7UUFDbEIsT0FBTyxFQUFNLEVBQUU7UUFDZixhQUFhLEVBQUMsQ0FBQztLQUNoQjtJQUtELFlBQVksQ0FBRSxDQUFLO1FBQ2pCLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUN2QixRQUFRLEdBQUcsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUN6QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQTtZQUM1QixJQUFJLGFBQWEsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBQyxDQUFDLENBQUE7WUFLcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxHQUFDLGFBQWEsQ0FBQTtZQUN4RyxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNYLE9BQU8sRUFBRSxJQUFJO2FBQ2QsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRVgsQ0FBQztJQUNELE9BQU8sQ0FBRSxHQUFPO1FBQ2QsSUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLGFBQWEsR0FBQyxDQUFDLENBQUE7UUFDL0IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFXLEVBQUUsRUFBRTtZQUNqQyxLQUFLLEdBQUcsT0FBTyxDQUFDLGFBQWEsR0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFBO1FBQ3pDLENB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S0QsTUFBTTtJQUVOLENBQUM7SUFLRCxRQUFRO0lBRVIsQ0FBQztJQUtELGlCQUFpQjtJQUVqQixDQUFDO0lBS0QsYUFBYTtJQUViLENBQUM7SUFLRCxpQkFBaUIsQ0FBQyxJQUFRO1FBQ3hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3hCLE9BQU8sRUFBRSxDQUFBO0lBQ1gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhcGkgZnJvbSAnLi4vLi4vLi4vLi4vc2VydmljZS9uZXQuc2VydmljZSc7XHJcbmxldCBpbnRlcnZhbDphbnkgPSBudWxsO1xyXG5QYWdlKHtcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXHJcbiAgICovXHJcbiAgc2NvcmVMaXN0Ojxhbnk+e30sXHJcbiAgZGF0YToge1xyXG4gICAgcGF0cm9sRGF0YTo8YW55Pnt9LFxyXG4gICAgc2NvcmluZzo8YW55Pnt9LFxyXG4gICAgc2NvcmluZ19pbmRleDowLFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yqg6L29XHJcbiAgICovXHJcbiAgYmluZEtleUlucHV0IChlOmFueSkge1xyXG4gICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbClcclxuICAgIGludGVydmFsID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGxldCB0ZW1wID0gdGhpcy5kYXRhLnNjb3JpbmdcclxuICAgICAgbGV0IGRlZHVjdF9wb2ludHMgPSBlLmRldGFpbC52YWx1ZS8xXHJcbiAgICAgIC8vIGxldCBwb2ludCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnBvaW50LzFcclxuICAgICAgLy8gaWYgKChkZWR1Y3RfcG9pbnRzKT4ocG9pbnQpKSB7XHJcbiAgICAgIC8vICAgZGVkdWN0X3BvaW50cyA9IHBvaW50XHJcbiAgICAgIC8vIH1cclxuICAgICAgdGVtcC5kZXRhaWxbZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhdLmRldGFpbFtlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pXS5kZWR1Y3RfcG9pbnRzPWRlZHVjdF9wb2ludHNcclxuICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICBzY29yaW5nOiB0ZW1wXHJcbiAgICAgIH0pXHJcbiAgICB9LCAxMDAwKTtcclxuICAgIFxyXG4gIH0sXHJcbiAgY2FsY3VsYSAoc3ViOmFueSkge1xyXG4gICAgbGV0IHRvdGFsID0gc3ViLmRlZHVjdF9wb2ludHMvMVxyXG4gICAgc3ViLmRldGFpbC5mb3JFYWNoKChlbGVtZW50OmFueSkgPT4ge1xyXG4gICAgICB0b3RhbCA9IGVsZW1lbnQuZGVkdWN0X3BvaW50cy8xICsgdG90YWxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRvdGFsXHJcbiAgfSxcclxuICBpbml0ICgpIHtcclxuICAgIGFwaS5nZXRDdXJyZW50UGVuYWx0aWVzKFwidW5pdFwiKS50aGVuKChyZXM6YW55KT0+e1xyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIHBhdHJvbERhdGE6IHJlc1xyXG4gICAgICB9KVxyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIHNjb3JpbmdfaW5kZXg6IHd4LmdldFN0b3JhZ2VTeW5jKCdzY29yaW5nX2luZGV4JyksXHJcbiAgICAgIH0pXHJcbiAgICAgIGxldCBzY29yaW5nID0gdGhpcy5kYXRhLnBhdHJvbERhdGEucGVuYWx0aWVzW3RoaXMuZGF0YS5zY29yaW5nX2luZGV4XVxyXG4gICAgICBzY29yaW5nLmRldGFpbC5mb3JFYWNoKChlbGVtZW50OmFueSkgPT4ge1xyXG4gICAgICAgIGVsZW1lbnQuZGVkdWN0X3BvaW50cyA9IDA7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzY29yaW5nLmRlZHVjdF9wb2ludHMgPSAwO1xyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIHNjb3Jpbmc6IHNjb3JpbmdcclxuICAgICAgfSlcclxuICAgICAgY29uc29sZS5sb2codGhpcy5kYXRhKVxyXG4gICAgfSlcclxuICB9LFxyXG4gIG9uUmVtb3ZlSW1nVGFwIChlOmFueSkge1xyXG4gICAgY29uc29sZS5sb2coZSwnZGVsZXRlJylcclxuICAgIGxldCBpbWFnZXMgPSBlLmRldGFpbC5hbGxcclxuICAgIGxldCBpbmRleCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4XHJcbiAgICAgIGxldCBzY29yaW5nID0gdGhpcy5kYXRhLnNjb3Jpbmc7XHJcbiAgICAgIHNjb3JpbmcuZGV0YWlsW2luZGV4XS5pbWFnZV91cmwgPSBpbWFnZXNcclxuICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICBzY29yaW5nOnNjb3JpbmdcclxuICAgICAgfSlcclxuICAgIGNvbnNvbGUubG9nKCB0aGlzLmRhdGEuc2NvcmluZylcclxuICB9LFxyXG4gIG9uSW1nQ2hhbmdlVGFwKGU6YW55KXtcclxuICAgIGxldCBpbWFnZXMgPSBlLmRldGFpbC5jdXJyZW50XHJcbiAgICBsZXQgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxyXG4gICAgbGV0IHNjb3JpbmcgPSB0aGlzLmRhdGEuc2NvcmluZztcclxuICAgIGNvbnNvbGUubG9nKGltYWdlcylcclxuICAgIGFwaS51cGxvYWRJbWdzKGltYWdlcykudGhlbigocmVzOmFueSk9PntcclxuICAgICAgc2NvcmluZy5kZXRhaWxbaW5kZXhdLmltYWdlX3VybCA9IFsuLi5zY29yaW5nLmRldGFpbFtpbmRleF0uaW1hZ2VfdXJsLC4uLnJlc11cclxuICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICBzY29yaW5nOnNjb3JpbmdcclxuICAgICAgfSlcclxuICAgIH0sKGVycjphbnkpPT57XHJcbiAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgc2NvcmluZzpzY29yaW5nXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gICAgXHJcbiAgfSxcclxuICB0ZXh0SW5wdXQoZTphbnkpe1xyXG4gICAgbGV0IHRleHQgPSBlLmRldGFpbC52YWx1ZTtcclxuICAgIGxldCBpbmRleCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4XHJcbiAgICBsZXQgc2NvcmluZyA9IHRoaXMuZGF0YS5zY29yaW5nO1xyXG4gICAgc2NvcmluZy5kZXRhaWxbaW5kZXhdLmRlc2MgPSB0ZXh0XHJcbiAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICBzY29yaW5nOnNjb3JpbmdcclxuICAgIH0pXHJcbiAgfSxcclxuICBjaGVjayAoKSB7XHJcbiAgICAvLyDlpoLmnpzmiaPliIbkuobmsqHmnInkuIrkvKDlm77niYcs57uI5q2iXHJcbiAgICBsZXQgZmxhZyA9IHRydWVcclxuICAgIGxldCBzY29yaW5nID0gdGhpcy5kYXRhLnNjb3JpbmdcclxuICAgIHNjb3JpbmcuZGV0YWlsLmZvckVhY2goKGVsZW1lbnQ6YW55KSA9PiB7XHJcbiAgICAgIGlmIChlbGVtZW50LmRlZHVjdF9wb2ludHM+MCYmZWxlbWVudC5pbWFnZV91cmwubGVuZ3RoIDwgMSkge1xyXG4gICAgICAgIGZsYWcgPSBmYWxzZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIGlmICghZmxhZykge1xyXG4gICAgICB3eC5zaG93VG9hc3Qoe1xyXG4gICAgICAgIHRpdGxlOifor7fkuLrmiaPliIbpobnkuIrkvKDlm77niYcnLFxyXG4gICAgICAgIGljb246J25vbmUnLFxyXG4gICAgICAgIGR1cmF0aW9uOjIwMDBcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIHJldHVybiBmbGFnO1xyXG4gIH0sXHJcbiAgY2FsUG9pdCAoKSB7XHJcbiAgICBsZXQgc2NvcmluZyA9IHRoaXMuZGF0YS5zY29yaW5nXHJcbiAgICBzY29yaW5nLmRldGFpbC5mb3JFYWNoKChlbGVtZW50OmFueSkgPT4ge1xyXG4gICAgICBlbGVtZW50LmRlZHVjdF9wb2ludHMgPSAwXHJcbiAgICAgIGVsZW1lbnQuZGVkdWN0X3BvaW50cyA9IHRoaXMuY2FsY3VsYShlbGVtZW50KVxyXG4gICAgfSk7XHJcbiAgICBzY29yaW5nLmRlZHVjdF9wb2ludHMgPSAwXHJcbiAgICBzY29yaW5nLmRlZHVjdF9wb2ludHMgPSB0aGlzLmNhbGN1bGEoc2NvcmluZyk7XHJcbiAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICBzY29yaW5nOnNjb3JpbmdcclxuICAgIH0pXHJcbiAgfSxcclxuICBzYXZlKGU6YW55KXtcclxuICAgIHd4LnNob3dMb2FkaW5nKHtcclxuICAgICAgdGl0bGU6J+aPkOS6pOS4rSdcclxuICAgIH0pXHJcbiAgICB0aGlzLmNhbFBvaXQoKVxyXG4gICAgbGV0IGNhblNhdmUgPSB0aGlzLmNoZWNrKCk7XHJcbiAgICBpZiAoIWNhblNhdmUpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IHBhdHJvbERhdGE6YW55ID0gdGhpcy5kYXRhLnBhdHJvbERhdGFcclxuICAgIHBhdHJvbERhdGFbJ3BlbmFsdGllcyddW3RoaXMuZGF0YS5zY29yaW5nX2luZGV4XSA9IHRoaXMuZGF0YS5zY29yaW5nXHJcbiAgICBhcGkuc2F2ZUN1cnJlbnRQZW5hbHRpZXMocGF0cm9sRGF0YSkudGhlbigocmVzOmFueSk9PntcclxuICAgICAgd3gucmVtb3ZlU3RvcmFnZVN5bmMoJ3Njb3JpbmdfaW5kZXgnKTtcclxuICAgICAgd3guaGlkZUxvYWRpbmcoKTtcclxuICAgICAgd3gubmF2aWdhdGVCYWNrKClcclxuICAgIH0pXHJcbiAgfSxcclxuICBvbkxvYWQoKSB7XHJcbiAgICB3eC5zaG93TG9hZGluZyh7dGl0bGU6J+WKoOi9veS4rSd9KVxyXG4gICAgdGhpcy5pbml0KCk7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliJ3mrKHmuLLmn5PlrozmiJBcclxuICAgKi9cclxuICBvblJlYWR5KCkge1xyXG4gICAgXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLmmL7npLpcclxuICAgKi9cclxuICBvblNob3coKSB7XHJcbiAgICB3eC5oaWRlTG9hZGluZygpXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cclxuICAgKi9cclxuICBvbkhpZGUoKSB7XHJcbiAgICBcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxyXG4gICAqL1xyXG4gIG9uVW5sb2FkKCkge1xyXG4gICAgXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i55u45YWz5LqL5Lu25aSE55CG5Ye95pWwLS3nm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcclxuICAgKi9cclxuICBvblB1bGxEb3duUmVmcmVzaCgpIHtcclxuICAgIFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxyXG4gICAqL1xyXG4gIG9uUmVhY2hCb3R0b20oKSB7XHJcbiAgICBcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlKjmiLfngrnlh7vlj7PkuIrop5LliIbkuqtcclxuICAgKi9cclxuICBvblNoYXJlQXBwTWVzc2FnZShvcHRzOmFueSk6IFdlY2hhdE1pbmlwcm9ncmFtLlBhZ2UuSUN1c3RvbVNoYXJlQ29udGVudCB7XHJcbiAgICBjb25zb2xlLmxvZyhvcHRzLnRhcmdldClcclxuICAgIHJldHVybiB7fVxyXG4gIH1cclxufSkiXX0=