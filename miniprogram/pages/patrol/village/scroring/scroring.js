"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const net_service_1 = require("../../../../service/net.service");
let interval = null;
Page({
    scoreList: {},
    data: {
        patrolData: {},
        scoring: {},
        scoring_index: 0,
    },
    bindKeyInput(e) {
        clearInterval(interval);
        interval = setTimeout(() => {
            let temp = this.data.scoring;
            let deduct_points = e.detail.value / 1;
            temp.detail[e.currentTarget.dataset.index].detail[e.currentTarget.dataset.i].deduct_points = deduct_points;
            this.setData({
                scoring: temp
            });
        }, 1000);
    },
    calcula(sub) {
        let total = sub.deduct_points / 1;
        sub.detail.forEach((element) => {
            total = element.deduct_points / 1 + total;
        });
        return total;
    },
    init() {
        net_service_1.default.getCurrentPenalties("village").then((res) => {
            this.setData({
                patrolData: res
            });
            this.setData({
                scoring_index: wx.getStorageSync('scoring_index'),
            });
            let scoring = this.data.patrolData.penalties[this.data.scoring_index];
            scoring.detail.forEach((element) => {
                element.deduct_points = 0;
            });
            scoring.deduct_points = 0;
            this.setData({
                scoring: scoring
            });
            console.log(this.data);
        });
    },
    onRemoveImgTap(e) {
        console.log(e, 'delete');
        let images = e.detail.all;
        let index = e.currentTarget.dataset.index;
        let scoring = this.data.scoring;
        scoring.detail[index].image_url = images;
        this.setData({
            scoring: scoring
        });
        console.log(this.data.scoring);
    },
    uploadImgs(images) {
        return new Promise((resolve) => {
        });
        console.log(images);
    },
    onImgChangeTap(e) {
        console.log(e);
        let images = e.detail.current;
        let scoring = this.data.scoring;
        let index = e.currentTarget.dataset.index;
        net_service_1.default.uploadImgs(images).then((res) => {
            scoring.detail[index].image_url = [...scoring.detail[index].image_url, ...res];
            this.setData({
                scoring: scoring
            });
        }, (err) => {
            this.setData({
                scoring: scoring
            });
        });
    },
    textInput(e) {
        let text = e.detail.value;
        let index = e.currentTarget.dataset.index;
        let scoring = this.data.scoring;
        scoring.detail[index].desc = text;
        this.setData({
            scoring: scoring
        });
    },
    check() {
        let flag = true;
        let scoring = this.data.scoring;
        scoring.detail.forEach((element) => {
            if (element.deduct_points > 0 && element.image_url.length < 1) {
                flag = false;
            }
        });
        if (!flag) {
            wx.showToast({
                title: '请为扣分项上传图片',
                icon: 'none',
                duration: 2000
            });
        }
        return flag;
    },
    calPoit() {
        let scoring = this.data.scoring;
        scoring.detail.forEach((element) => {
            element.deduct_points = 0;
            element.deduct_points = this.calcula(element);
        });
        scoring.deduct_points = 0;
        scoring.deduct_points = this.calcula(scoring);
        this.setData({
            scoring: scoring
        });
    },
    save(e) {
        wx.showLoading({
            title: '提交中'
        });
        this.calPoit();
        let canSave = this.check();
        if (!canSave) {
            return;
        }
        let patrolData = this.data.patrolData;
        patrolData['penalties'][this.data.scoring_index] = this.data.scoring;
        net_service_1.default.saveCurrentPenalties(patrolData).then((res) => {
            wx.removeStorageSync('scoring_index');
            wx.hideLoading();
            wx.navigateBack();
        });
    },
    onLoad() {
        wx.showLoading({ title: '加载中' });
        this.init();
    },
    onReady() {
    },
    onShow() {
        wx.hideLoading();
    },
    onHide() {
    },
    onUnload() {
    },
    onPullDownRefresh() {
    },
    onReachBottom() {
    },
    onShareAppMessage(opts) {
        console.log(opts.target);
        return {};
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb3JpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzY3JvcmluZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlFQUFrRDtBQUNsRCxJQUFJLFFBQVEsR0FBTyxJQUFJLENBQUE7QUFDdkIsSUFBSSxDQUFDO0lBS0gsU0FBUyxFQUFNLEVBQUU7SUFDakIsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFNLEVBQUU7UUFDbEIsT0FBTyxFQUFNLEVBQUU7UUFDZixhQUFhLEVBQUMsQ0FBQztLQUNoQjtJQUtELFlBQVksQ0FBRSxDQUFLO1FBQ2pCLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUN2QixRQUFRLEdBQUcsVUFBVSxDQUFDLEdBQUUsRUFBRTtZQUN4QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQTtZQUM1QixJQUFJLGFBQWEsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBQyxDQUFDLENBQUE7WUFLcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxHQUFDLGFBQWEsQ0FBQTtZQUN4RyxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNYLE9BQU8sRUFBRSxJQUFJO2FBQ2QsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxFQUFDLElBQUksQ0FBQyxDQUFBO0lBRVQsQ0FBQztJQUNELE9BQU8sQ0FBRSxHQUFPO1FBQ2QsSUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLGFBQWEsR0FBQyxDQUFDLENBQUE7UUFDL0IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFXLEVBQUUsRUFBRTtZQUNqQyxLQUFLLEdBQUcsT0FBTyxDQUFDLGFBQWEsR0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFBO1FBQ3pDLENB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RUFBQyxLQUFLLEVBQUMsQ0FBQyxDQUFBO1FBQzdCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFLRCxPQUFPO0lBRVAsQ0FBQztJQUtELE1BQU07UUFDSixFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7SUFDbEIsQ0FBQztJQUtELE1BQU07SUFFTixDQUFDO0lBS0QsUUFBUTtJQUVSLENBQUM7SUFLRCxpQkFBaUI7SUFFakIsQ0FBQztJQUtELGFBQWE7SUFFYixDQUFDO0lBS0QsaUJBQWlCLENBQUMsSUFBUTtRQUN4QixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUN4QixPQUFPLEVBQUUsQ0FBQTtJQUNYLENBQUM7Q0FDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXBpIGZyb20gJy4uLy4uLy4uLy4uL3NlcnZpY2UvbmV0LnNlcnZpY2UnO1xyXG5sZXQgaW50ZXJ2YWw6YW55ID0gbnVsbFxyXG5QYWdlKHtcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXHJcbiAgICovXHJcbiAgc2NvcmVMaXN0Ojxhbnk+e30sXHJcbiAgZGF0YToge1xyXG4gICAgcGF0cm9sRGF0YTo8YW55Pnt9LFxyXG4gICAgc2NvcmluZzo8YW55Pnt9LFxyXG4gICAgc2NvcmluZ19pbmRleDowLFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yqg6L29XHJcbiAgICovXHJcbiAgYmluZEtleUlucHV0IChlOmFueSkge1xyXG4gICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbClcclxuICAgIGludGVydmFsID0gc2V0VGltZW91dCgoKT0+e1xyXG4gICAgICBsZXQgdGVtcCA9IHRoaXMuZGF0YS5zY29yaW5nXHJcbiAgICAgIGxldCBkZWR1Y3RfcG9pbnRzID0gZS5kZXRhaWwudmFsdWUvMVxyXG4gICAgICAvLyBsZXQgcG9pbnQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5wb2ludC8xXHJcbiAgICAgIC8vIGlmICgoZGVkdWN0X3BvaW50cyk+KHBvaW50KSkge1xyXG4gICAgICAvLyAgIGRlZHVjdF9wb2ludHMgPSBwb2ludFxyXG4gICAgICAvLyB9XHJcbiAgICAgIHRlbXAuZGV0YWlsW2UuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4XS5kZXRhaWxbZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaV0uZGVkdWN0X3BvaW50cz1kZWR1Y3RfcG9pbnRzXHJcbiAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgc2NvcmluZzogdGVtcFxyXG4gICAgICB9KVxyXG4gICAgfSwxMDAwKVxyXG4gICAgXHJcbiAgfSxcclxuICBjYWxjdWxhIChzdWI6YW55KSB7XHJcbiAgICBsZXQgdG90YWwgPSBzdWIuZGVkdWN0X3BvaW50cy8xXHJcbiAgICBzdWIuZGV0YWlsLmZvckVhY2goKGVsZW1lbnQ6YW55KSA9PiB7XHJcbiAgICAgIHRvdGFsID0gZWxlbWVudC5kZWR1Y3RfcG9pbnRzLzEgKyB0b3RhbFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdG90YWxcclxuICB9LFxyXG4gIGluaXQgKCkge1xyXG4gICAgYXBpLmdldEN1cnJlbnRQZW5hbHRpZXMoXCJ2aWxsYWdlXCIpLnRoZW4oKHJlczphbnkpPT57XHJcbiAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgcGF0cm9sRGF0YTogcmVzXHJcbiAgICAgIH0pXHJcbiAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgc2NvcmluZ19pbmRleDogd3guZ2V0U3RvcmFnZVN5bmMoJ3Njb3JpbmdfaW5kZXgnKSxcclxuICAgICAgfSlcclxuICAgICAgbGV0IHNjb3JpbmcgPSB0aGlzLmRhdGEucGF0cm9sRGF0YS5wZW5hbHRpZXNbdGhpcy5kYXRhLnNjb3JpbmdfaW5kZXhdXHJcbiAgICAgIHNjb3JpbmcuZGV0YWlsLmZvckVhY2goKGVsZW1lbnQ6YW55KSA9PiB7XHJcbiAgICAgICAgZWxlbWVudC5kZWR1Y3RfcG9pbnRzID0gMDtcclxuICAgICAgfSk7XHJcbiAgICAgIHNjb3JpbmcuZGVkdWN0X3BvaW50cyA9IDA7XHJcbiAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgc2NvcmluZzogc2NvcmluZ1xyXG4gICAgICB9KVxyXG4gICAgICBjb25zb2xlLmxvZyh0aGlzLmRhdGEpXHJcbiAgICB9KVxyXG4gIH0sXHJcbiAgb25SZW1vdmVJbWdUYXAgKGU6YW55KSB7XHJcbiAgICBjb25zb2xlLmxvZyhlLCdkZWxldGUnKVxyXG4gICAgbGV0IGltYWdlcyA9IGUuZGV0YWlsLmFsbFxyXG4gICAgbGV0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXhcclxuICAgICAgbGV0IHNjb3JpbmcgPSB0aGlzLmRhdGEuc2NvcmluZztcclxuICAgICAgc2NvcmluZy5kZXRhaWxbaW5kZXhdLmltYWdlX3VybCA9IGltYWdlc1xyXG4gICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgIHNjb3Jpbmc6c2NvcmluZ1xyXG4gICAgICB9KVxyXG4gICAgY29uc29sZS5sb2coIHRoaXMuZGF0YS5zY29yaW5nKVxyXG4gIH0sXHJcbiAgdXBsb2FkSW1ncyAoaW1hZ2VzOkFycmF5PGFueT4pIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSAoKHJlc29sdmUpPT57XHJcbiAgICAgIFxyXG4gICAgfSlcclxuICAgIGNvbnNvbGUubG9nKGltYWdlcylcclxuICB9LFxyXG4gIG9uSW1nQ2hhbmdlVGFwKGU6YW55KXtcclxuICAgIGNvbnNvbGUubG9nKGUpXHJcbiAgICBsZXQgaW1hZ2VzID0gZS5kZXRhaWwuY3VycmVudFxyXG4gICAgbGV0IHNjb3JpbmcgPSB0aGlzLmRhdGEuc2NvcmluZztcclxuICAgIGxldCBpbmRleCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4XHJcbiAgICBhcGkudXBsb2FkSW1ncyhpbWFnZXMpLnRoZW4oKHJlczphbnkpPT57XHJcbiAgICAgIHNjb3JpbmcuZGV0YWlsW2luZGV4XS5pbWFnZV91cmwgPSBbLi4uc2NvcmluZy5kZXRhaWxbaW5kZXhdLmltYWdlX3VybCwuLi5yZXNdXHJcbiAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgc2NvcmluZzpzY29yaW5nXHJcbiAgICAgIH0pXHJcbiAgICB9LChlcnI6YW55KSA9PiB7XHJcbiAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgc2NvcmluZzpzY29yaW5nXHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH0sXHJcbiAgdGV4dElucHV0KGU6YW55KXtcclxuICAgIGxldCB0ZXh0ID0gZS5kZXRhaWwudmFsdWU7XHJcbiAgICBsZXQgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleFxyXG4gICAgbGV0IHNjb3JpbmcgPSB0aGlzLmRhdGEuc2NvcmluZztcclxuICAgIHNjb3JpbmcuZGV0YWlsW2luZGV4XS5kZXNjID0gdGV4dFxyXG4gICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgc2NvcmluZzpzY29yaW5nXHJcbiAgICB9KVxyXG4gIH0sXHJcbiAgLy8gdXBsb2FkSW1hZ2VzIChzY29yaW5nOmFueSkge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKT0+e1xyXG4gIC8vICAgICBsZXQgYWxsID0gMFxyXG4gIC8vICAgICBsZXQgZmluaXNoID0gMFxyXG4gIC8vICAgICBzY29yaW5nLmRldGFpbC5mb3JFYWNoKChlbGVtZW50OmFueSxpbmRleDpudW1iZXIpID0+IHtcclxuICAvLyAgICAgICBsZXQgcGljYXJyID0gPGFueT5bXTtcclxuICAvLyAgICAgICBlbGVtZW50LmltYWdlX3VybC5mb3JFYWNoKChpbWc6c3RyaW5nLGk6bnVtYmVyKSA9PiB7XHJcbiAgLy8gICAgICAgICBhbGwgPSBhbGwgKyAxXHJcbiAgLy8gICAgICAgICBhcGkudXBsb2FkRmlsZShpbWcpLnRoZW4oKHJlczphbnkpPT57XHJcbiAgLy8gICAgICAgICAgICAgbGV0IHVybCA9IEpTT04ucGFyc2UocmVzLmRhdGEpLnJlc3VsdExpc3RbMF0uYWNjZXNzX3VybFxyXG4gIC8vICAgICAgICAgICAgIHBpY2Fyci5wdXNoKHVybClcclxuICAvLyAgICAgICAgICAgICBmaW5pc2ggPSBmaW5pc2ggKyAxXHJcbiAgLy8gICAgICAgICAgICAgaWYoaSA9PT0gZWxlbWVudC5pbWFnZV91cmwubGVuZ3RoLTEpIHtcclxuICAvLyAgICAgICAgICAgICAgIGVsZW1lbnQuaW1hZ2VfdXJsID0gcGljYXJyO1xyXG4gIC8vICAgICAgICAgICAgIH1cclxuICAvLyAgICAgICAgICAgICBpZiAoYWxsID09PSBmaW5pc2gpIHtcclxuICAvLyAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgLy8gICAgICAgICAgICAgICAgIHNjb3Jpbmc6c2NvcmluZ1xyXG4gIC8vICAgICAgICAgICAgICAgfSlcclxuICAvLyAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSlcclxuICAvLyAgICAgICAgICAgICB9XHJcbiAgLy8gICAgICAgICB9KVxyXG4gIC8vICAgICAgIH0pO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgICAgaWYgKGFsbCA9PT0gMCkge1xyXG4gIC8vICAgICAgIHJlc29sdmUodHJ1ZSlcclxuICAvLyAgICAgfVxyXG4gIC8vICAgfSlcclxuICAvLyB9LFxyXG4gIGNoZWNrICgpIHtcclxuICAgIC8vIOWmguaenOaJo+WIhuS6huayoeacieS4iuS8oOWbvueJhyznu4jmraJcclxuICAgIGxldCBmbGFnID0gdHJ1ZVxyXG4gICAgbGV0IHNjb3JpbmcgPSB0aGlzLmRhdGEuc2NvcmluZ1xyXG4gICAgc2NvcmluZy5kZXRhaWwuZm9yRWFjaCgoZWxlbWVudDphbnkpID0+IHtcclxuICAgICAgaWYgKGVsZW1lbnQuZGVkdWN0X3BvaW50cz4wJiZlbGVtZW50LmltYWdlX3VybC5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgZmxhZyA9IGZhbHNlXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYgKCFmbGFnKSB7XHJcbiAgICAgIHd4LnNob3dUb2FzdCh7XHJcbiAgICAgICAgdGl0bGU6J+ivt+S4uuaJo+WIhumhueS4iuS8oOWbvueJhycsXHJcbiAgICAgICAgaWNvbjonbm9uZScsXHJcbiAgICAgICAgZHVyYXRpb246MjAwMFxyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZsYWc7XHJcbiAgfSxcclxuICBjYWxQb2l0ICgpIHtcclxuICAgIGxldCBzY29yaW5nID0gdGhpcy5kYXRhLnNjb3JpbmdcclxuICAgIHNjb3JpbmcuZGV0YWlsLmZvckVhY2goKGVsZW1lbnQ6YW55KSA9PiB7XHJcbiAgICAgIGVsZW1lbnQuZGVkdWN0X3BvaW50cyA9IDBcclxuICAgICAgZWxlbWVudC5kZWR1Y3RfcG9pbnRzID0gdGhpcy5jYWxjdWxhKGVsZW1lbnQpXHJcbiAgICB9KTtcclxuICAgIHNjb3JpbmcuZGVkdWN0X3BvaW50cyA9IDBcclxuICAgIHNjb3JpbmcuZGVkdWN0X3BvaW50cyA9IHRoaXMuY2FsY3VsYShzY29yaW5nKTtcclxuICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgIHNjb3Jpbmc6c2NvcmluZ1xyXG4gICAgfSlcclxuICB9LFxyXG4gIHNhdmUoZTphbnkpe1xyXG4gICAgd3guc2hvd0xvYWRpbmcoe1xyXG4gICAgICB0aXRsZTon5o+Q5Lqk5LitJ1xyXG4gICAgfSlcclxuICAgIHRoaXMuY2FsUG9pdCgpXHJcbiAgICBsZXQgY2FuU2F2ZSA9IHRoaXMuY2hlY2soKTtcclxuICAgIGlmICghY2FuU2F2ZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsZXQgcGF0cm9sRGF0YTphbnkgPSB0aGlzLmRhdGEucGF0cm9sRGF0YVxyXG4gICAgcGF0cm9sRGF0YVsncGVuYWx0aWVzJ11bdGhpcy5kYXRhLnNjb3JpbmdfaW5kZXhdID0gdGhpcy5kYXRhLnNjb3JpbmdcclxuICAgIGFwaS5zYXZlQ3VycmVudFBlbmFsdGllcyhwYXRyb2xEYXRhKS50aGVuKChyZXM6YW55KT0+e1xyXG4gICAgICB3eC5yZW1vdmVTdG9yYWdlU3luYygnc2NvcmluZ19pbmRleCcpO1xyXG4gICAgICB3eC5oaWRlTG9hZGluZygpO1xyXG4gICAgICB3eC5uYXZpZ2F0ZUJhY2soKVxyXG4gICAgfSlcclxuICB9LFxyXG4gIG9uTG9hZCgpIHtcclxuICAgIHd4LnNob3dMb2FkaW5nKHt0aXRsZTon5Yqg6L295LitJ30pXHJcbiAgICB0aGlzLmluaXQoKTtcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWIneasoea4suafk+WujOaIkFxyXG4gICAqL1xyXG4gIG9uUmVhZHkoKSB7XHJcbiAgICBcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouaYvuekulxyXG4gICAqL1xyXG4gIG9uU2hvdygpIHtcclxuICAgIHd4LmhpZGVMb2FkaW5nKClcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdoumakOiXj1xyXG4gICAqL1xyXG4gIG9uSGlkZSgpIHtcclxuICAgIFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Y246L29XHJcbiAgICovXHJcbiAgb25VbmxvYWQoKSB7XHJcbiAgICBcclxuICB9LFxyXG5cclxuICAvKipcclxuICAgKiDpobXpnaLnm7jlhbPkuovku7blpITnkIblh73mlbAtLeebkeWQrOeUqOaIt+S4i+aLieWKqOS9nFxyXG4gICAqL1xyXG4gIG9uUHVsbERvd25SZWZyZXNoKCkge1xyXG4gICAgXHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICog6aG16Z2i5LiK5ouJ6Kem5bqV5LqL5Lu255qE5aSE55CG5Ye95pWwXHJcbiAgICovXHJcbiAgb25SZWFjaEJvdHRvbSgpIHtcclxuICAgIFxyXG4gIH0sXHJcblxyXG4gIC8qKlxyXG4gICAqIOeUqOaIt+eCueWHu+WPs+S4iuinkuWIhuS6q1xyXG4gICAqL1xyXG4gIG9uU2hhcmVBcHBNZXNzYWdlKG9wdHM6YW55KTogV2VjaGF0TWluaXByb2dyYW0uUGFnZS5JQ3VzdG9tU2hhcmVDb250ZW50IHtcclxuICAgIGNvbnNvbGUubG9nKG9wdHMudGFyZ2V0KVxyXG4gICAgcmV0dXJuIHt9XHJcbiAgfVxyXG59KSJdfQ==